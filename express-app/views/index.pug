
extends layout

block body
  nav.navbar.navbar-inverse.navbar-fixed-top
    .container
      .navbar-header
        button.navbar-toggle.collapsed(type='button', data-toggle='collapse', data-target='#navbar', aria-expanded='false', aria-controls='navbar')
          span.sr-only Toggle navigation
          span.icon-bar
          span.icon-bar
          span.icon-bar
        a.navbar-brand(href='#') Well-instrumented
      #navbar.collapse.navbar-collapse
        ul.nav.navbar-nav
          li.active
            a(href='#') Home

  block content
    div(style='padding: 40px 15px; text-align: center;')
      .container
        h1 Serverless Well-instrumented Application
          p.lead
            br
            | This app is an example of how to deploy a serverless frontend application. 
            br
            br
            | It is instrumented to collect user experience metrics including 
            a(href='https://developers.google.com/web/tools/lighthouse/audits/time-to-interactive') time to interative (TTI)
            |  and deployment details. It will automatically roll back if there are errors using AWS CodeDeploy features.
          p.img
            img(src='//via.placeholder.com/350x150', title='hero image')
            script.
              newrelic.setCustomAttribute('timeToHeroImage', Date.now() - performance.timing.navigationStart);

    //- Instrument session with current deployed function version
    script!=addInstrumentationJs('functionVersion', AWS_LAMBDA_FUNCTION_VERSION)
    script(src='https://unpkg.com/tti-polyfill@0.2.2/tti-polyfill.js')
    //- Instrument time to interactive using polyfill
    script.
      ttiPolyfill.getFirstConsistentlyInteractive().then(function(tti) {
        newrelic.addToTrace({'timeToInteractive': performance.timing.navigationStart + tti});
        newrelic.setCustomAttribute('timeToInteractive', tti);
      });
    script.
      throw new Error('synthetic error');
